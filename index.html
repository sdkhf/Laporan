<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Laporan Keuangan</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f0f0f0; }
    .form-group { margin-bottom: 10px; }
    .btn { padding: 6px 12px; background: #007bff; color: #fff; border: none; border-radius: 3px; cursor: pointer; }
    .btn:hover { background: #0056b3; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <h1>Laporan Keuangan</h1>
  <form id="form-transaksi">
    <div class="form-group">
      <label>Tanggal: <input type="date" name="tanggal" required></label>
    </div>
    <div class="form-group">
      <label>Jenis:
        <select name="jenis">
          <option value="Pemasukan">Pemasukan</option>
          <option value="Pengeluaran">Pengeluaran</option>
        </select>
      </label>
    </div>
    <div class="form-group">
      <label>Deskripsi: <input type="text" name="deskripsi" required></label>
    </div>
    <div class="form-group">
      <label>Jumlah: <input type="number" name="jumlah" step="0.01" required></label>
    </div>
    <div class="form-group">
      <label>Mata Uang:
        <select name="mata_uang">
          <option value="SAR">SAR</option>
          <option value="USD">USD</option>
          <option value="IDR">IDR</option>
        </select>
      </label>
    </div>
    <button class="btn" type="submit">Tambah</button>
  </form>
  <h2>Data Transaksi</h2>
  <table id="tabel-transaksi">
    <thead>
      <tr>
        <th>Tanggal</th>
        <th>Jenis</th>
        <th>Deskripsi</th>
        <th>Jumlah</th>
        <th>Mata Uang</th>
        <th>Hapus</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <br>
  <button class="btn" onclick="eksporExcel()">Ekspor ke Excel</button>
  <button class="btn" onclick="eksporPDF()">Ekspor ke PDF</button>
  <script>
    function getTransaksi() {
      return JSON.parse(localStorage.getItem('transaksi') || '[]');
    }
    function setTransaksi(data) {
      localStorage.setItem('transaksi', JSON.stringify(data));
    }
    function renderTransaksi() {
      const data = getTransaksi();
      const tbody = document.querySelector('#tabel-transaksi tbody');
      tbody.innerHTML = '';
      data.forEach((trx, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${trx.tanggal}</td>
          <td>${trx.jenis}</td>
          <td>${trx.deskripsi}</td>
          <td>${trx.jumlah}</td>
          <td>${trx.mata_uang}</td>
          <td><button onclick="hapusTransaksi(${i})">Hapus</button></td>
        `;
        tbody.appendChild(tr);
      });
    }
    function hapusTransaksi(idx) {
      const data = getTransaksi();
      data.splice(idx, 1);
      setTransaksi(data);
      renderTransaksi();
    }
    document.getElementById('form-transaksi').onsubmit = function(e) {
      e.preventDefault();
      const form = e.target;
      const data = getTransaksi();
      data.push({
        tanggal: form.tanggal.value,
        jenis: form.jenis.value,
        deskripsi: form.deskripsi.value,
        jumlah: form.jumlah.value,
        mata_uang: form.mata_uang.value
      });
      setTransaksi(data);
      form.reset();
      renderTransaksi();
    };
    function eksporExcel() {
      const data = getTransaksi();
      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Laporan');
      XLSX.writeFile(wb, 'laporan_keuangan.xlsx');
    }
    function eksporPDF() {
      const data = getTransaksi();
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text('Laporan Keuangan', 105, 15, { align: 'center' });
      let y = 30;
      doc.setFontSize(10);
      data.forEach(trx => {
        doc.text(`${trx.tanggal} | ${trx.jenis} | ${trx.deskripsi} | ${trx.jumlah} ${trx.mata_uang}`, 10, y);
        y += 8;
        if (y > 280) { doc.addPage(); y = 20; }
      });
      doc.save('laporan_keuangan.pdf');
    }
    renderTransaksi();
  </script>
</body>
</html>
